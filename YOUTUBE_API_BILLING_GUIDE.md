# YouTube API 유료 전환 가이드

YouTube Data API v3는 **무료 일일 할당량(10,000 유닛/일)**을 제공하지만, 추가 사용량이 필요할 경우 유료로 전환할 수 있습니다.

---

## 📊 현재 사용량 분석

### 무료 할당량
- **일일 한도**: 10,000 유닛
- **Search API 비용**: 100 유닛/호출
- **Videos API 비용**: 1 유닛/호출

### 현재 앱 사용량 (최적화 후)
- **검색 1회**: 약 1,500 유닛 (15개 채널 × 100 유닛)
- **하루 가능 횟수**: 약 6~7회
- **API 키 3개 사용 시**: 약 20회/일 (30,000 유닛)
- **캐싱 시스템 적용 시**: 중복 검색 시 0 유닛 (무제한)

---

## 💰 YouTube API 유료 요금

### 가격 정책
- **비용**: **$0 (무료)** - 기본 10,000 유닛까지
- **추가 비용**: 없음 (현재 YouTube Data API는 **무료**입니다!)

### ⚠️ 중요 사실
**YouTube Data API v3는 완전 무료입니다!**
- Google Cloud의 다른 API(Gemini, Cloud Functions 등)와 달리 **결제 정보를 입력해도 요금이 청구되지 않습니다**
- 단, 할당량 증가 신청을 위해 결제 정보가 필요할 수 있습니다
- 실제 비용은 **$0**입니다

---

## 🚀 할당량 증가 신청 방법

YouTube API는 무료이지만, 일일 할당량을 늘리고 싶다면 Google에 신청할 수 있습니다.

### 1단계: Google Cloud Console 접속
1. [Google Cloud Console](https://console.cloud.google.com/) 접속
2. 프로젝트 선택: `safer-tube-on`

### 2단계: YouTube Data API 페이지 이동
1. 좌측 메뉴: **API 및 서비스** → **라이브러리**
2. "YouTube Data API v3" 검색 및 선택
3. **할당량** 탭 클릭

### 3단계: 할당량 증가 신청
1. **할당량 증가 요청** 버튼 클릭
2. 신청 양식 작성:
   - **프로젝트 이름**: safer-tube-on
   - **API**: YouTube Data API v3
   - **요청 할당량**: 50,000 또는 100,000 유닛/일
   - **사용 목적**:
     ```
     교육용 안전 영상 추천 서비스입니다.
     초/중등 교사들이 수업에 활용할 안전한 YouTube 영상을 검색하고,
     AI로 자동 분석하여 유해 콘텐츠를 필터링합니다.

     일일 사용자 수: 약 50~100명 (교사)
     검색 횟수: 하루 약 30~50회
     현재 할당량으로 부족하여 증가 신청합니다.
     ```

3. **제출** 클릭

### 4단계: 승인 대기
- 보통 **1~3일** 소요
- Google에서 이메일로 승인 결과 통보
- 승인되면 자동으로 할당량 증가

---

## 🎯 할당량 최적화 전략 (이미 적용됨)

### ✅ 이미 구현된 최적화
1. **캐싱 시스템** (searchCache.js)
   - 24시간 동일 검색 시 API 호출 0
   - Firestore에 검색 결과 저장
   - 중복 검색 시 즉시 반환

2. **API 키 로테이션**
   - 3개 API 키 자동 전환 (youtube.js)
   - 할당량 3배 증가 (30,000 유닛/일)

3. **검색 키워드 최적화**
   - OpenAI로 가장 관련성 높은 키워드만 사용
   - 3개 키워드 → 1개 키워드 (66% 절감)

### 💡 추가 최적화 방안 (선택)
1. **신뢰채널 수 줄이기**
   - 15개 → 10개 채널 (33% 절감)
   - `youtube.js` 파일에서 `TRUSTED_CHANNELS` 수정

2. **검색 결과 수 줄이기**
   - 채널당 20개 → 15개 (25% 절감)
   - `searchTrustedChannelVideos()` 함수의 `maxResults` 조정

---

## 📈 할당량 사용량 모니터링

### Google Cloud Console에서 확인
1. [Google Cloud Console](https://console.cloud.google.com/) 접속
2. 프로젝트: `safer-tube-on`
3. **API 및 서비스** → **대시보드**
4. **YouTube Data API v3** 클릭
5. **할당량** 탭에서 실시간 사용량 확인

### 콘솔 로그로 확인
앱 실행 시 브라우저 콘솔에서 확인 가능:
```
✅ 신뢰채널: 18개 발견 (키워드: "먹과 색 표현")  ← API 호출 15회 (1,500 유닛)
💾 캐시된 결과 사용: 18개 영상 (API 호출 0)   ← API 호출 0회 (0 유닛)
```

---

## 🔧 트러블슈팅

### 문제: "quotaExceeded" 에러
**원인**: 일일 할당량 초과

**해결**:
1. 다음날까지 대기 (자정에 초기화)
2. 다른 API 키로 전환 (자동)
3. 할당량 증가 신청

### 문제: "API key not valid" 에러
**원인**: API 키 제한 설정 문제

**해결**:
1. [Google Cloud Console](https://console.cloud.google.com/) 접속
2. **API 및 서비스** → **사용자 인증 정보**
3. 해당 API 키 클릭
4. **API 제한사항**: "제한 안함" 또는 "YouTube Data API v3만" 선택
5. **저장**

---

## 📌 요약

### 현재 상태
- ✅ 캐싱 시스템 적용 (24시간)
- ✅ API 키 3개 로테이션 (30,000 유닛/일)
- ✅ 검색 키워드 최적화 (66% 절감)
- ✅ YouTube API는 **완전 무료**

### 권장 사항
1. **일반 사용**: 현재 설정으로 충분 (하루 20회 검색 가능)
2. **중급 사용**: 할당량 증가 신청 (50,000 유닛/일)
3. **대량 사용**: 할당량 증가 신청 + 추가 API 키

### 비용
- **YouTube API**: $0 (무료)
- **Firebase**: 무료 플랜으로 충분
- **OpenAI API**: 사용량에 따라 약 $0.10~$1/월 (GPT-4o-mini는 매우 저렴)

---

**💡 결론**: YouTube API는 무료이므로, 할당량 증가 신청만 하면 추가 비용 없이 무제한 사용 가능합니다!
